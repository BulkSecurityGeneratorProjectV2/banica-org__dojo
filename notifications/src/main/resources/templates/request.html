<!DOCTYPE HTML>
<html xmlns:th="https://www.thymeleaf.org">
<head>
    <title>Game Notifications</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
    <link href="https://getbootstrap.com/docs/4.0/examples/signin/signin.css" rel="stylesheet" crossorigin="anonymous"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="/resources/demos/style.css">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <!--    <script th:inline="javascript" type="text/javascript" th:src="@{/js/tables-autocomplete.js}"></script>-->
</head>

<body>
<h2 style="text-align:center">Custom query for leaderboard</h2>
<div class="container">
    <form action="#" th:action="@{/request}" th:object="${newRequest}" method="post">
        <table align="center">
            <tr>
                <td>
                    <br>
                    <label>SELECT</label>
                    <input type="text" style="width:275px" th:field="*{queryParameters}" value="*"/>
                </td>
            </tr>
            <tr>
                <td>
                    <div class="ui-widget">
                        <label for="tables">FROM </label>
                        <input id="tables" style="width:278px" placeholder="leaderboard/docker_events"
                               th:field="*{queryTable}">
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    <div class="ui-widget">
                        <input id="column_names" style="width:330px" placeholder="WHERE/LIMIT..."
                               th:field="*{querySpecification}">
                    </div>
                </td>
            </tr>
            <tr>
            </tr>
            <tr>
                <td>
                    <label>Select who will be notified: </label>
                    <br>
                    <select style="width:330px" th:field="*{receiver}">
                        <option value="All" class="form-option-input" id="notifyAll" th:field="*{receiver}">All
                        </option>
                        <option value="Common" class="form-option-input" id="notifyCommon" th:field="*{receiver}">Only
                            Channel/Sensei
                        </option>
                        <option value="Participant" class="form-option-input" id="notifyParticipant"
                                th:field="*{receiver}">Only Participants
                        </option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>
                    <label>Describe your query: </label>
                    <br>
                    <input type="text" style="width:330px" th:field="*{describingMessage}" required
                           placeholder="Enter a description here"/>
                </td>
            </tr>
            <tr>
                <td>
                    <label>Notification message: </label>
                    <br>
                    <input type="text" style="width:330px" th:field="*{notificationMessage}"
                           placeholder="Enter a message here"/>
                </td>
            </tr>
            <tr>
                <td>
                    <br>
                    <button type="submit" style="text-align:left" class="btn btn-primary" name="action" value="add"/>
                    Add</button>
                    <form action="#" th:action="@{/contest}" th:object="${newContest}" method="post">
                        <button type="submit" style="margin-left:215px;" class="btn btn-primary" name="action"
                                value="back" formnovalidate/>
                        Back</button>
                    </form>
                </td>
            </tr>
        </table>
    </form>
</div>

<script th:inline="javascript">
    $( "#tables" ).autocomplete({
      source: [[${tables.keySet()}]]
    });

  $( function() {
    function get_columns() {
        var tables = [[${tables}]];
        table = document.getElementById("tables").value;
        return tables[table];
    };
    function split( val ) {
        return val.split( /@/ );
    }
    function extractLast( term ) {
        return split( term ).pop();
    }

    $( "#column_names" )
      .on( "keydown", function( event ) {
        if ( event.keyCode === $.ui.keyCode.TAB &&
            $( this ).autocomplete( "instance" ).menu.active ) {
          event.preventDefault();
        }
      })
      .autocomplete({
        minLength: 0,
        source: function( request, response ) {
          response( $.ui.autocomplete.filter(
            get_columns(), extractLast(request.term) ) );
        },
        focus: function() {
          return false;
        },
        select: function( event, ui ) {
          var terms = split( this.value );
          terms.pop();
          terms.push( ui.item.value );
          terms.push( "" );
          this.value = terms.join( "" );
          return false;
        }
      });
  } );

</script>

</body>
</html>